#!/usr/bin/env node

var spawn = require('child_process').spawn

var processArguments = require('./processArguments')


const QEMU = 'node_modules/qemu/usr/bin/qemu-'


var args = processArguments(process.argv.slice(2))

var cpu = args.cpu


// [Hack] Can't be able to use x86_64 as generic x86 64 bits CPU
var toolchainCpu = (cpu === 'nocona') ? 'x86_64' : cpu

const LD_LIBRARY_PATH = '../nodeos-cross-toolchain/out/'+toolchainCpu+'-nodeos-linux-'+args.libc+'/lib'

process.env.LD_LIBRARY_PATH = LD_LIBRARY_PATH
var command = QEMU+args.cpu_family
var argv = [LD_LIBRARY_PATH+'/libc.so', 'obj/'+cpu+'/node', '--interactive']

if(args.argv)
  argv = argv.concat(args.argv)

spawn(command, argv, {stdio: 'inherit'})
.on('exit', process.exit.bind(process))
