#!/usr/bin/env node

var cp   = require('child_process')
var join = require('path').join

var manager = require('download-manager')


const DEPS='deps'


// Dependencies versions

const GENEXT2FS_VERSION = "1.4.1"


// Dependencies URLs

const GENEXT2FS_URL="https://github.com/5paceManSpiff/genext2fs/archive/nodeos-"+GENEXT2FS_VERSION+".tar.gz"


//
// genext2fs
//

var downloads =
[
  {
    name: 'genext2fs',
    url: GENEXT2FS_URL,
    action: function(callback)
    {
      var options = {cwd: join(DEPS, this.name)}

      cp.execFile('./autogen.sh', options, function(error)
      {
        if(error) return callback(error)

        cp.execFile('./configure', options, function(error)
        {
          if(error) return callback(error)

          cp.exec('make', options, callback)
        })
      })
    }
  }
]


manager(downloads, {path: DEPS}, function(error)
{
  if(error) throw error;
})
