#! /usr/bin/env bash

# NodeOS
#
# Copyright (c) 2013-2017 Jacob Groundwater, Jesús Leganés-Combarro 'piranna'
# and other contributors
#
# MIT License

set -o pipefail


if [[ `uname` == Darwin ]]; then
  PORT='port install'

  $PORT libtool automake autoconf pkgconfig || 1
  $PORT texinfo texlive                     || 2
else
  APT='apt-get -qq -y'

  #
  # Install Ubuntu dependencies
  # The dependencies of one level would also be needed for the next ones
  #

  # Update cache
  dpkg --add-architecture i386 &&
  $APT update                  || exit 10


  # cross-compiler
  $APT install gcc g++ texinfo || exit 20

  # barebones
  $APT install bc || exit 21

  # rootfs
  $APT install genisoimage libuuid1:i386 || exit 22

  # usersfs
  $APT install autoconf automake || exit 23


  # QEmu
  $APT install libpixman-1-dev libsdl1.2-dev || exit 30


  # Update Node.js to v0.12 from the NodeSource repository
  curl -sL https://deb.nodesource.com/setup_0.12 | bash &&
  $APT install nodejs                                   || exit 40
fi
